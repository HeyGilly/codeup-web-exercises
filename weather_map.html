<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta charset="utf-8">
        <meta name="creator" content="Nicholas 'Gilly' Gilmore">
        <meta name="subject" content="Weather API">
        <meta name="description" content=" Using HTML, CSS, jQuery, AJAX, and the OpenWeatherMap API,to create a weather map of your location ">
        <!-- Mapbox CSS -->
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
        <!-- Personal StyleSheet -->
        <link href="css/weather_map.css" type="text/css" rel="stylesheet">
        <!--Font Awesome -->
        <script src="https://kit.fontawesome.com/5d0c1b436d.js" crossorigin="anonymous"></script>

        <title>Weather Map</title>



        <style>
            #map {
                /* the width and height may be set to any size */
                min-width: 240px;
                width: 80vw;
                max-width: 620px;
                min-height: 200px;
                height: 80vw;
                max-height: 400px;
                margin: 0 auto;
                border-radius: 12px;
                border: 5px solid whitesmoke;
                box-shadow: 0 4px 10px #1e1e1e;
            }
            #mapContainer{
            }
        </style>
    </head>
    <body>

    <div id="timeAndDate">
        <div id="todaysTime"></div>
        <span class="smalldates" id="dateDay">day</span> |
        <span class="smalldates" id="dateDate">date</span>
    </div>
    <main>


        <div class="formContainer">
            <input id="searchCity" type="text" placeholder="Search City.." name="search">
            <button type="btn" id="buttonSearch"><i class="fa-solid fa-magnifying-glass-location"></i></button>
        </div>







        <div class="mainContainer">
            <section id="mainLeft">
                <h2 id="cityName"></h2>
                <section class="fahrenheitContainer">
                    <p id="todaysFahrenheit"></p>&#x2109;
                </section>
                <section id="highLowContainer">
                    <p class="highest">High</p><p class="lowest">low</p>
                </section>
                <p id="mainDescription"></p>
                <p id="humidity"></p>
            </section>
            <section id="mainRight">
                <img id="wicon" src="" alt="Weather icon">
            </section>
        </div>


        <div class="fourDayContainer">
            <section class="fourdaysection">
                <p class="little1stDay">day</p>
                <img id="littleIcon1" src="" alt="Tomorrow's Weather icon">
                <p class="little1stDescribe littleDes">day</p>
                <section id="highLowFourDay1">
                    <p class="high4Day1 highlow">High</p><p class="low4Day1 highlow">low</p>
                </section>
                <p class="dailyHumid1 dailyHum"></p>
            </section>
            <section class="fourdaysection">
                <p class="little2ndDay">day</p>
                <img id="littleIcon2" src="" alt="Tomorrow's Weather icon">
                <p class="little2ndDescribe littleDes">day</p>
                <section id="highLowFourDay2">
                    <p class="high4Day2 highlow">High</p><p class="low4Day2 highlow">low</p>
                </section>
                <p class="dailyHumid2 dailyHum"></p>
            </section>
            <section class="fourdaysection">
                <p class="little3rdDay">day</p>
                <img id="littleIcon3" src="" alt="Tomorrow's Weather icon">
                <p class="little3rdDescribe littleDes">day</p>
                <section id="highLowFourDay3">
                    <p class="high4Day3 highlow">High</p><p class="low4Day3 highlow">low</p>
                </section>
                <p class="dailyHumid3 dailyHum"></p>
            </section>
            <section class="fourdaysection" id="hidden300">
                <p class="little4thDay">day</p>
                <img id="littleIcon4" src="" alt="Tomorrow's Weather icon">
                <p class="little4thDescribe littleDes">day</p>
                <section id="highLowFourDay4">
                    <p class="high4Day4 highlow">High</p><p class="low4Day4 highlow">low</p>
                </section>
                <p class="dailyHumid4 dailyHum"></p>
            </section>
            <section id="hidden" class="fourdaysection">
                <p class="little5thDay">day</p>
                <img id="littleIcon5" src="" alt="Tomorrow's Weather icon">
                <p class="little5thDescribe littleDes">day</p>
                <section id="highLowFourDay5">
                    <p class="high4Day5 highlow">High</p><p class="low4Day5 highlow">low</p>
                </section>
                <p class="dailyHumid5 dailyHum"></p>
            </section>
        </div>

    </main>

    <!-- The HTML element that serves as the Mapbox container -->
    <div id="mapContainer">
        <div id='map'></div>
    </div>

<!--    <footer>-->
<!--        <small> HeyGilly 2022</small>-->
<!--    </footer>-->

    </body>
    <script src="js/keys.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <!-- Mapbox JS -->
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
    <!-- Mapbox Geocoder Util Methods -->
    <script src="js/mapbox-geocoder-utils.js"></script>
    <script>
        mapboxgl.accessToken = MapBox_Token;
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v10',
            zoom: 10,
            center: [-98.4916, 29.4252]
        });

        let x;
        $("#buttonSearch").click(function (e) {
            e.preventDefault;
            x = document.getElementById("searchCity").value;
            // alert(x);
            // // the  geocode method from mapbox-geocoder-utils.js
            geocode(x, MapBox_Token).then(function(result) {
                map.setCenter(result);
                map.setZoom(15);
                map.setStyle('mapbox://styles/mapbox/dark-v10')
            });
        });


    </script>
    <script>
        $.get("https://api.openweathermap.org/data/2.5/weather", {
            APPID: Weather_Token,
            q:     "San Antonio, US",
            lang: "en",
            units: "imperial"
        }).done(function(data) {
            // Todays Time
            const today = new Date();
            $('#todaysTime').html(today.toLocaleTimeString("en-US"));
            //Todays Day
            const weekdays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
            $('#dateDay').html(weekdays[today.getDay()]);
            //Todays Date by month and date
            const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
            $('#dateDate').html(months[today.getMonth()] + ' ' +today.getUTCDate());
            console.log(data);
            //--- City Name
            // console.log(data.name);
            $('#cityName').html(data.name);
            //--- Main Weather and Description
            // console.log(data.weather[0].main);
            // console.log(data.weather[0].description);
            $('#mainWeather').html(data.weather[0].main);
            $('#mainDescription').html(data.weather[0].description);


            //--- Showcase the icon for WeatherMap
            const iconcode = data.weather[0].icon;
            var iconurl = "http://openweathermap.org/img/w/" + iconcode + ".png";
            $('#wicon').attr('src', iconurl);

            //-- Sunrise today's time
            const sunrise = data.sys.sunrise;
            var myDate = new Date(1000*sunrise);
            // console.log(myDate.toLocaleTimeString("en-US"));
            //-- Sunset today's time
            const sunset = data.sys.sunset;
            var myDate = new Date(1000*sunset);
            // console.log(myDate.toLocaleTimeString("en-US"));

            //Todays Fahrenheit
            $("#todaysFahrenheit").html(Math.round(data.main.temp));
            $(".highest").html("<small>H</small>: "+Math.round(data.main.temp_max));
            $(".lowest").html("<small>L</small>: "+Math.round(data.main.temp_min));
            $("#humidity").html("Humidity: "+Math.round(data.main.humidity)+"%");
        });


        $.get("http://api.openweathermap.org/data/2.5/forecast?id=524901", {
            APPID: Weather_Token,
            q:     "San Antonio, US",
            lang: "en",
            units: "imperial"
        }).done(function(data) {
            const dataList = data.list;
            console.log(dataList)
            console.log(dataList[0].dt_txt)
            // Tomorrows Date
            const today = new Date();
            const weekdays = ["Mon","Tues","Wed","Thurs","Fri","Sat","Sun"];
            $('.little1stDay').html(weekdays[today.getDay()]);
            $('.little2ndDay').html(weekdays[today.getDay()+1]);
            $('.little3rdDay').html(weekdays[today.getDay()+2]);
            $('.little4thDay').html(weekdays[today.getDay()+3]);
            $('.little5thDay').html(weekdays[today.getDay()+4]);


            console.log(Math.round(dataList[5].main.temp_max));
            $(".high4Day1").html("<small>H</small>: "+Math.round(dataList[5].main.temp_min));
            $(".low4Day1").html("<small>L</small>: "+Math.round(dataList[5].main.temp_max));

            $(".high4Day2").html("<small>H</small>: "+Math.round(dataList[10].main.temp_min));
            $(".low4Day2").html("<small>L</small>: "+Math.round(dataList[10].main.temp_max));

            $(".high4Day3").html("<small>H</small>: "+Math.round(dataList[15].main.temp_min));
            $(".low4Day3").html("<small>L</small>: "+Math.round(dataList[15].main.temp_max));

            $(".high4Day4").html("<small>H</small>: "+Math.round(dataList[20].main.temp_min));
            $(".low4Day4").html("<small>L</small>: "+Math.round(dataList[20].main.temp_max));

            $(".high4Day5").html("H:"+Math.round(dataList[25].main.temp_min));
            $(".low4Day5").html("L: "+Math.round(dataList[25].main.temp_max));


            $('.little1stDescribe').html(dataList[5].weather[0].description);
            $('.little2ndDescribe').html(dataList[10].weather[0].description);
            $('.little3rdDescribe').html(dataList[15].weather[0].description);
            $('.little4thDescribe').html(dataList[20].weather[0].description);
            $('.little5thDescribe').html(dataList[25].weather[0].description);




            //--- Showcase the icon for WeatherMap
            const iconcode1 = dataList[5].weather[0].icon;
            const iconcode2 = dataList[10].weather[0].icon;
            const iconcode3 = dataList[15].weather[0].icon;
            const iconcode4 = dataList[20].weather[0].icon;
            const iconcode5 = dataList[20].weather[0].icon;

            var iconurl1 = "http://openweathermap.org/img/w/" + iconcode1 + ".png";
            var iconurl2 = "http://openweathermap.org/img/w/" + iconcode2 + ".png";
            var iconurl3 = "http://openweathermap.org/img/w/" + iconcode3 + ".png";
            var iconurl4 = "http://openweathermap.org/img/w/" + iconcode4 + ".png";
            var iconurl5 = "http://openweathermap.org/img/w/" + iconcode5 + ".png";

            $('#littleIcon1').attr('src', iconurl1);
            $('#littleIcon2').attr('src', iconurl2);
            $('#littleIcon3').attr('src', iconurl3);
            $('#littleIcon4').attr('src', iconurl4);
            $('#littleIcon5').attr('src', iconurl5);


            $(".dailyHumid1").html("Humidity: "+Math.round(dataList[5].main.humidity)+"%");
            $(".dailyHumid2").html("Humidity: "+Math.round(dataList[10].main.humidity)+"%");
            $(".dailyHumid3").html("Humidity: "+Math.round(dataList[15].main.humidity)+"%");
            $(".dailyHumid4").html("Humidity: "+Math.round(dataList[20].main.humidity)+"%");
            $(".dailyHumid5").html("Humidity: "+Math.round(dataList[25].main.humidity)+"%");
        });




    </script>




</html>