<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta charset="utf-8">
        <meta name="creator" content="Nicholas 'Gilly' Gilmore">
        <meta name="Weather App" content="Weather API">
        <meta name="description"
              content=" Using HTML, CSS,Bootstrap, jQuery, AJAX, and the OpenWeatherMap API,to create a weather map of your location ">
       <!--Favicon -->
        <link rel="icon" type="image/x-icon" href="img/favicon.png">
        <!-- Mapbox CSS -->
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
        <!-- Personal StyleSheet -->
        <link href="css/weather_map.css" type="text/css" rel="stylesheet">
        <!--Font Awesome -->
        <script src="https://kit.fontawesome.com/5d0c1b436d.js" crossorigin="anonymous"></script>
        <!--BootStrap css -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <!-- JQuery -->
        <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
        <!-- Title of Page -->
        <title>Weather Map</title>



    </head>
    <body>

        <header id="timeAndDate" class="text-center pb-5">
                <div id="todaysTime" class="">00:00</div>
                <span class="smalldates mr-3" id="dateDay">day</span> |
                <span class="smalldates ml-3" id="dateDate">date</span>
        </header>

        <div class="formContainer d-flex justify-content-center py-5">
            <input id="searchCity" class="w-50 pl-5 text-capitalize rounded-left" type="text" placeholder="Search City..">
            <button type="btn" class="border-0 bg-transparent searchButton"><i class="fa-solid fa-magnifying-glass-location p-2 rounded-right"></i></button>
        </div>

        <main class="mainContainer mx-auto rounded h-auto border-0">
            <section>
                <h2 id="cityName" class="pl-4 pt-4">CityName</h2>
                <span class="d-flex"><p id="todaysFahrenheit">00</p>&#x2109;</span>
                <span class="d-flex"><p class="highest pr-1">High</p><p class="lowest pl-1">low</p></span>
                <p id="mainDescription"> describe</p>
                <p id="humidity">Humidity</p>
            </section>
            <section>
                <img id="wicon" src="" alt="Weather icon">
            </section>

        </main>


        <div id='map' class="mx-auto pt-5 rounded"></div>


    </body>
    <!-- Personal CheatCODES -->
    <script src="js/keys.js"></script>
    <!-- Boostrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- Mapbox JS -->
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
    <!-- Mapbox Geocoder Util Methods -->
    <script src="js/mapbox-geocoder-utils.js"></script>
    <!-- Weather data placement -->
    <script>
        $.get("http://api.openweathermap.org/data/2.5/onecall", {
            APPID: Weather_Token,
            lat:    29.423017,
            lon:   -98.48527,
            units: "imperial",
            lang: "en"
        }).done(function(data) {
            console.log( data);
            console.log( );

            //Todays Time in Military
            displayTime();

            mapboxgl.accessToken = MapBox_Token;
            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/light-v10',
                zoom: 10,
                center: [-98.4936282, 29.4241219]
            });

            // reverse geocode method for the Heading 2
            reverseGeocode({lng: data.lon , lat: data.lat}, MapBox_Token).then(function(results) {
                //-- From the start of the show, this will show San Antonio
                $('h2').html(results.substring(0,12))
            });

            //----- When a button is clicked map will change and title will change
            $(".searchButton").click(function (e) {
                e.preventDefault;
                let x = document.getElementById("searchCity").value;
                //-- This will change the heading 2 with the value
                $('h2').html(x);
                geocode(x, MapBox_Token).then(function(result) {
                    map.setCenter(result);
                    map.setZoom(10);
                    map.setStyle('mapbox://styles/mapbox/dark-v10');
                    console.log(result)
                    //--- Makes a maker when clicked
                    var marker = new mapboxgl.Marker()
                        .setLngLat(result)
                        .addTo(map);
                });
            });

            //-- Current Weahter Fahrenheit
            console.log(Math.round(data.current.temp));
            $('#todaysFahrenheit').html(Math.round(data.current.temp));


            //-- Sunset today's time
            const sunset = data.current.sunset;
            var myDate = new Date(1000*sunset);
            console.log(myDate.toLocaleTimeString("en-US"));
            //-- Sunset today's time
            const sunrise = data.current.sunrise;
            var myDate = new Date(1000*sunrise);
            console.log(myDate.toLocaleTimeString("en-US"));




        });

        function displayTime(){
            //Todays Time in Military
            var today = new Date();
            var hours = (today.getHours() < 10 ? '0' : '') + today.getHours();
            var minutes = (today.getMinutes() < 10 ? '0' : '') + today.getMinutes();
            $('#todaysTime').html(hours + ":" + minutes);
            // Today's Day
            const weekdays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
            $('#dateDay').html(weekdays[today.getDay()]);
            //
            const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
            $('#dateDate').html(months[today.getMonth()] + ' ' +today.getUTCDate());
        }
    </script>
    <!-- MapBox Script ----->






    </script>

</html>